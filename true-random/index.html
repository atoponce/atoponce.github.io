<!DOCTYPE html>
<html>
  <head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <title>True RandomJavaScript entropy</title>
    <link rel='shortcut icon' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAC0SURBVFjDY3xvF/afAQ+oX30cp9wpgTp8Whn0LFfilW85Z4hX/tnNBKziTAxDEIw6etTRo44edfSoo0cdPeroUUePOpoAYNnsEoFXwQm9nTjlqiLe4NXLxqmOV176VSVe+WtTfEeTx6ijRx096uhRR486etTRo44edfTIaZpucYjEqyBWTBinnI9GGF69L5Nq8co3+N3FK++WyD+aPEYdPeroUUePOnrU0aOOHnX0qKNHjKMByz0ZyC/b2mYAAAAASUVORK5CYII=' />
    <script>
        let intervalId;

        function getNow() { return performance.now(); }
        function flipCoin() { let coin = 0; const later = getNow() + 1; while (getNow() <= later) coin ^= 1; return coin; }
        function fairBit() { while (true) { const bit = flipCoin(); if (bit !== flipCoin()) return bit; } }
        function genByte() { let byte = 0; let bits = 8; while (bits--) { byte <<= 1; byte |= fairBit(); } return byte; }

        function toBinary() { return genByte().toString(2).padStart(8, '0'); }
        function toHex() { return genByte().toString(16).padStart(2, '0'); }
        function toColors() { return `rgb(${genByte()}, ${genByte()}, ${genByte()})`; }

        function streamHex() { document.getElementById('trueRandom').insertAdjacentHTML('afterbegin', toHex()); }
        function streamColors() { document.getElementById('trueRandom').insertAdjacentHTML('afterbegin', "<span style='background-color:" + toColors() + "'>&nbsp;</span>"); }
        function streamBinary() { document.getElementById('trueRandom').insertAdjacentHTML('afterbegin', toBinary()); }

        function startStream() {
            let choice;
            const option = document.getElementById('streamChoice');
            const selected = option.options[option.selectedIndex].text;
            if (selected === 'Binary') choice = streamBinary;
            else if (selected === 'Colors') choice = streamColors;
            else if (selected === 'Hexadecimal') choice = streamHex;
            stopStream();
            intervalId = setInterval(choice);
        }
        function stopStream() { clearInterval(intervalId); }
        function clearStream() { document.getElementById('trueRandom').innerHTML = ''; }
    </script>
    <style>
        #container {
            margin: 0 auto;
            width: 800px;
        }
        #trueRandom {
            font-family: monospace;
            margin-top: 5px;
            white-space: wrap;
            overflow-wrap: break-word;
        }
    </style>
  </head>
  <body>
    <div id="container">
        <h1>JavaScript TRNG</h1>
        <p>This is a true random number generator in pure JavaScript. No, this is not a joke. It models coin flips by pitting a slow clock (the RTC) against a fast clock (the CPU). The RTC models the coin's flight in the air and the CPU models the spin of the coin.</p>
        <p>A timer is set 1 millisecond into the future and a bit is flipped as fast as possible before the timer expires. Due to the operating system's kernel interrupt handling, the bit flips are dependent on the stress of the system, which is chaotic and unpredictable. Finally, two successive bits are debiased using <a href="https://en.wikipedia.org/wiki/Randomness_extractor#Von_Neumann_extractor">John von Neumann's randomness extractor</a> to ensure uniformity.</p>
        <p>This was first <a href="https://www.cs.miami.edu/home/burt/learning/Math609.0/CryptoLib/cryptolib_1.1/cryptolib/src/unix_truerand.c">investigated by cryptographer Matt Blaze 1995</a> then <a href="https://dankaminsky.com/2012/08/15/dakarand/">later by security researcher Dan Kaminsky in 2012</a>. It was also included in <a href="https://www.schneier.com/books/applied-cryptography-source/">Applied Cryptography by Bruce Schneier</a>. Due to the 1 ms timer however, it is slower than most modern RNGs. This page is designed to behave similarly to the live streams feature provided by the <a href="https://qrng.anu.edu.au/">Australian National University QRNG</a>.</p>
        <p>This page is entirely self-contained and does not require any external resources. Download this page to your computer, and run it offline.</p>
        <select id="streamChoice">
            <option>Binary</option>
            <option>Colors</option>
            <option selected>Hexadecimal</option>
        </select>
        <button onclick="startStream()">Start</button>
        <button onclick="stopStream()">Stop</button>
        <button onclick="clearStream()">Clear</button>
        <div id="trueRandom"></div textarea>
    </div>
    <script>
        startStream()
    </script>
  </body>
</html>